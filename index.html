<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FaceMark - Reconocimiento Facial con Landmarks</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>Reconocimiento Facial por Landmarks</h1>
                <div class="mode-selector">
                    <button id="mode-capture" class="mode-btn active">üì∏ Captura/Entrenamiento</button>
                    <button id="mode-inference" class="mode-btn">üîç Inferencia</button>
                </div>
            </div>
        </header>

        <div class="main-content">
            <!-- Columna izquierda: C√°mara, m√©tricas y log -->
            <div class="video-section">
                <div class="video-container">
                    <video id="webcam" autoplay playsinline></video>
                    <canvas id="canvas"></canvas>
                    
                    <!-- M√©tricas superpuestas en el video -->
                    <div class="video-metrics">
                        <div class="video-metric">
                            <span class="vm-label">FPS</span>
                            <span class="vm-value" id="fps-display">--</span>
                        </div>
                        <div class="video-metric">
                            <span class="vm-label">Tiempo</span>
                            <span class="vm-value" id="inference-time">-- ms</span>
                        </div>
                    </div>
                    
                    <!-- Progreso de captura superpuesto -->
                    <div class="video-progress" id="capture-progress"></div>
                </div>
            </div>

            <!-- Columna derecha: Controles -->
            <div class="controls-section">
                <!-- Registro de alumnos (solo modo captura) -->
                <div class="panel mode-capture-only">
                    <h2>üìù Registro de Alumnos</h2>
                    <div class="form-group">
                        <label for="student-name">Nombre del alumno:</label>
                        <input type="text" id="student-name" placeholder="Ej: Juan P√©rez">
                    </div>
                    <button id="btn-capture" class="btn btn-primary">
                        üì∏ Capturar 5 segundos
                    </button>
                    <p class="help-text">
                        Captura ~75 frames durante 5 segundos. Gira la cabeza y gesticula para mejorar el reconocimiento.
                    </p>
                </div>

                <!-- Predicci√≥n (solo modo inferencia) - MOVIDO ARRIBA -->
                <div class="panel mode-inference-only panel-prediction-top">
                    <h2>üîç Predicci√≥n en Vivo</h2>
                    <button id="btn-predict" class="btn btn-secondary">
                        ‚ñ∂Ô∏è Iniciar Predicci√≥n
                    </button>
                    <div id="prediction-result" class="prediction-box">
                        <div class="prediction-name">--</div>
                        <div class="prediction-distance">Distancia: --</div>
                    </div>
                </div>

                <!-- Configuraci√≥n (solo modo inferencia) -->
                <div class="panel mode-inference-only panel-compact">
                    <h2>‚öôÔ∏è k-NN</h2>
                    <div class="knn-config-grid">
                        <div class="form-group-inline">
                            <label for="k-value">k</label>
                            <input type="range" id="k-value" min="1" max="10" value="3">
                            <span id="k-display" class="value-display">3</span>
                        </div>
                        <div class="form-group-inline">
                            <label for="threshold">œÑ</label>
                            <input type="range" id="threshold" min="0.5" max="8.0" step="0.1" value="3.0">
                            <span id="threshold-display" class="value-display">3.0</span>
                        </div>
                        <div class="form-group-inline form-group-full">
                            <label for="distance-metric">M√©trica</label>
                            <select id="distance-metric">
                                <option value="euclidean" selected>Eucl√≠dea</option>
                                <option value="cosine">Coseno</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Selecci√≥n de zonas faciales (solo modo inferencia) -->
                <div class="panel panel-zones mode-inference-only panel-compact">
                    <h2>üéØ Zonas Activas</h2>
                    
                    <!-- Contenedor en dos columnas -->
                    <div class="zones-two-column">
                        <!-- Columna 1: Diagrama facial interactivo -->
                        <div class="face-diagram-container">
                            <svg viewBox="0 0 200 240" class="face-diagram">
                            <!-- Contorno -->
                            <ellipse cx="100" cy="120" rx="70" ry="90" class="face-zone zone-contour" data-zone="contour" />
                            
                            <!-- Cejas -->
                            <path d="M 60 85 Q 75 80 90 85" class="face-zone zone-eyebrows" data-zone="eyebrows" stroke-width="6" fill="none" />
                            <path d="M 110 85 Q 125 80 140 85" class="face-zone zone-eyebrows" data-zone="eyebrows" stroke-width="6" fill="none" />
                            
                            <!-- Ojos -->
                            <ellipse cx="75" cy="100" rx="15" ry="10" class="face-zone zone-eyes" data-zone="eyes" />
                            <ellipse cx="125" cy="100" rx="15" ry="10" class="face-zone zone-eyes" data-zone="eyes" />
                            
                            <!-- Nariz -->
                            <path d="M 100 110 L 95 135 L 100 138 L 105 135 Z" class="face-zone zone-nose" data-zone="nose" />
                            
                            <!-- Boca -->
                            <ellipse cx="100" cy="165" rx="25" ry="15" class="face-zone zone-mouth" data-zone="mouth" />
                            
                            <!-- Etiquetas -->
                            <text x="100" y="230" class="zone-label" text-anchor="middle">Clic para activar/desactivar</text>
                        </svg>
                        </div>

                        <!-- Columna 2: Controles de peso -->
                        <div class="zone-weights">
                            <div class="weight-control" data-zone="eyes">
                            <span class="weight-label">üëÅÔ∏è Ojos: <strong id="weight-eyes">2.0</strong></span>
                            <input type="range" class="weight-slider" data-zone="eyes" min="0.5" max="3.0" step="0.1" value="2.0">
                        </div>
                        <div class="weight-control" data-zone="nose">
                            <span class="weight-label">üëÉ Nariz: <strong id="weight-nose">1.5</strong></span>
                            <input type="range" class="weight-slider" data-zone="nose" min="0.5" max="3.0" step="0.1" value="1.5">
                        </div>
                        <div class="weight-control" data-zone="mouth">
                            <span class="weight-label">üëÑ Boca: <strong id="weight-mouth">1.0</strong></span>
                            <input type="range" class="weight-slider" data-zone="mouth" min="0.5" max="3.0" step="0.1" value="1.0">
                        </div>
                        <div class="weight-control" data-zone="eyebrows">
                            <span class="weight-label">ü§® Cejas: <strong id="weight-eyebrows">1.2</strong></span>
                            <input type="range" class="weight-slider" data-zone="eyebrows" min="0.5" max="3.0" step="0.1" value="1.2">
                        </div>
                            <div class="weight-control" data-zone="contour">
                                <span class="weight-label">‚≠ï Contorno: <strong id="weight-contour">0.8</strong></span>
                                <input type="range" class="weight-slider" data-zone="contour" min="0.5" max="3.0" step="0.1" value="0.8">
                            </div>
                        </div>
                    </div>
                    
                    <button id="btn-reset-zones" class="btn btn-small btn-block">
                        üîÑ Restaurar por defecto
                    </button>
                </div>

                <!-- Lista de alumnos (solo modo captura) -->
                <div class="panel mode-capture-only">
                    <h2>üë• Alumnos Registrados (<span id="student-count">0</span>)</h2>
                    <ul id="student-list" class="student-list"></ul>
                </div>

                <!-- Gesti√≥n de datos (solo modo captura) -->
                <div class="panel mode-capture-only">
                    <h2>üíæ Gesti√≥n de Datos</h2>
                    <div class="button-group">
                        <button id="btn-export" class="btn btn-small">üì§ Exportar JSON</button>
                        <label for="file-import" class="btn btn-small">üì• Importar JSON</label>
                        <input type="file" id="file-import" accept=".json" style="display: none;">
                        <button id="btn-clear" class="btn btn-small btn-danger">üóëÔ∏è Borrar Todo</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MediaPipe desde CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js" crossorigin="anonymous"></script>
    
    <!-- Aplicaci√≥n principal -->
    <script src="app.js"></script>
</body>
</html>
